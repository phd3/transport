buildscript {
  dependencies {
    classpath('com.linkedin.transport:transportable-udfs-plugin')
    //classpath files('/Users/akrai/Repo/transport/transportable-udfs-plugin/build/libs/transportable-udfs-plugin-0.0.62.jar')
  }
}

apply plugin: 'idea'
apply plugin: 'java'
apply plugin: 'test.transport.plugin'
apply plugin: 'application'

String engineProperty = System.getProperty("engine", "other")
if (engineProperty.equalsIgnoreCase('trino')) {
  // Trino has a minimum jdk requirement on java 11
  println 'Running build for Trino'
  transport.engines = ['trino']
  java {
    toolchain.languageVersion.set(JavaLanguageVersion.of(11))
  }
} else {
  println 'Running build for Spark & Hive'
  transport.engines = ['hive', 'spark']
  java {
    toolchain.languageVersion.set(JavaLanguageVersion.of(8))
  }
}

// If the license plugin is applied, disable license checks for the autogenerated source sets
tasks.whenTaskAdded { task ->
  if (task.name.startsWith("licenseTrino")
      || task.name.startsWith("licenseHive")
      || task.name.startsWith("licenseSpark")) {
    task.enabled = false
  }
}

dependencies {
  // TODO: Reference all external dependencies from a single gradle file
  compile('com.google.guava:guava:24.1-jre')
  compile('org.apache.commons:commons-io:1.3.2')
}

// TODO: Add a debugPlatform flag to allow debugging specific test methods in IntelliJ
// for a particular platform other than default
